function datapicker2(e){var a=$.extend({data:null,active_level:1,init_value:[],item_height:40,item_number:5,event_init:null,event_ok:null,event_cancel:null},e);("number"!==$.type(a.item_height)||a.item_height<=0)&&(a.item_height=40),"number"!==$.type(a.item_number)||a.item_number<3?a.number=1:0===Math.floor(a.item_number/2)&&(a.item_number=a.item_number-1),$.isArray(a.init_value)||(a.init_value=[a.init_value]);var i=[],t=[a.data];function l(e){var a=s.find(".pick-item-"+e.level);if(a.length>0)for(a.text(e.name).data("value",e.value),a=a.next(".pick-item");a.length>0;){var i=a.next();a.remove(),a=i,i=null}else s.append('<div class="pick-item pick-item-'+e.level+'" data-value="'+e.value+'" data-level="'+e.level+'">'+e.name+"</div>")}function n(e){var i="",t={value:0,name:"请选择",level:e.level};if(e.data)for(var n in e.data)e.value&&e.value==n?(t.value=n,t.name=e.data[n].name,i+='<a class="pick-item hover checked" href="javascript:;" data-value="'+n+'" style="height:'+a.item_height+'px">'+e.data[n].name+"</a>"):i+='<a class="pick-item hover" href="javascript:;" data-value="'+n+'" style="height:'+a.item_height+'px">'+e.data[n].name+"</a>";l(t);var v=d.find(".pick-list-"+e.level);return v.length>0?v.html(i):d.append('<div class="pick-list pick-list-'+e.level+'" data-level="'+e.level+'">'+i+"</div>"),t}function v(){i=[];for(var e=a.data,v=-1,c=0;c<a.active_level&&a.init_value[c];c++){var u=n({data:e,level:c,value:a.init_value[c]});if(i[c]={name:u.name,value:u.value},t[c]=e,!e[a.init_value[c]]){e=null;break}e=e[a.init_value[c]].value,v=c}-1===v?(n({data:a.data,level:0}),v=0):v+1<a.active_level&&l({level:v+1,name:"请选择",value:0}),s.find(".pick-item").removeClass("checked").filter(".pick-item-"+v).addClass("checked");var r=d.find(".pick-list").removeClass("show");r=r.filter(".pick-list-"+v).addClass("show"),setTimeout(function(){var e=r.find(".pick-item.checked");e.length>0&&r.scrollTop(a.item_height*(e.index()-Math.floor(a.item_number/2)))},10)}var c=$('<a class="pick-close" href="javascript:;"></a>').on("click",function(){h.hide()}),s=$('<div class="pick-now"></div>').on("click",".pick-item",function(){var e=$(this),v=e.data("level");if(e.data("value"))if(v+1===a.active_level)$.isFunction(a.event_ok)&&a.event_ok(i),h.hide();else{e.addClass("checked");var c=d.find(".pick-list").removeClass("show").filter(".pick-list-"+v).addClass("show");(o=c.find('.pick-item[data-value="'+e.data("value")+'"]').addClass("checked")).length>0&&c.scrollTop(a.item_height*(o.index()-Math.floor(a.item_number/2)));var u=e.next(".pick-item");if(u.length>0)for(u.text("请选择").data("value",0).removeClass("checked"),u=u.next();u.length>0;){var r=u.next();u.remove(),u=r,r=null}u=null}else if(v>0){var o;(o=$(".pick-list-"+(v-1)+" .pick-item.checked")).length>0&&(i[v-1]={name:o.text(),value:o.data("value")},t[v]=t[v-1][o.data("value")].value,l({level:v,name:o.text(),value:o.data("value")}),n({data:t[v],level:v}),s.find(".pick-item").removeClass("checked").filter(".pick-item-"+v).addClass("checked"),d.find(".pick-list").removeClass("show").filter(".pick-list-"+v).addClass("show").scrollTop(0))}}),d=$('<div class="pick-main"></div>').css({height:a.item_height*a.item_number}).on("click",".pick-item",function(){var e=$(this),v=e.closest(".pick-list").data("level");i[v]={name:e.text(),value:e.data("value")},v+1<a.active_level?(e.addClass("checked").siblings().removeClass("checked"),t[v+1]=t[v][e.data("value")].value,l({level:v,name:e.text(),value:e.data("value")}),n({data:t[v+1],level:v+1}),s.find(".pick-item").removeClass("checked").filter(".pick-item-"+(v+1)).addClass("checked"),d.find(".pick-list").removeClass("show").filter(".pick-list-"+(v+1)).addClass("show").scrollTop(0)):($.isFunction(a.event_ok)&&a.event_ok(i),h.hide())}),u=$('<div class="pick-box"></div>').append(s.append(c),d),r=$('<div class="pick-bg"></div>').on("click",function(){h.hide()}).on("touchmove",function(e){e.preventDefault()}),o=$('<div class="pick-wrap"></div>').append(r,u),m=$('<div class="datapick2"></div>');$.isFunction(a.event_init)&&(v(),a.event_init(i)),$("body").append(m.append(o));var h={show:function(e,i){(i||a.data)&&(i&&(a.data=i),e&&$.isArray(e)?a.init_value=e:e&&!$.isArray(e)?a.init_value=[e]:a.init_value=[null],v(),m.css("display","block"),setTimeout(function(){m.addClass("open")},50))},hide:function(){m.removeClass("open"),setTimeout(function(){m.css("display","none")},400)}};return h}