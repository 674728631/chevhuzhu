"use strict";!function(){var n=!1,e=checkLogin(!0),t=null,i=1,o="2019-01-01",a=new Date(o+" 00:00:00");if(e){if(_config.is_wx_mobile&&configWXJSSDK(["chooseWXPay","hideAllNonBaseMenuItem"],{success:function(){wx.hideAllNonBaseMenuItem(),t&&r(t)}}),Date.now()>=a)return void showConfirm({str:"购买截止有效期已过，下次再来吧",btn_yes:{str:"回到首页",href:"/hfive/view/index.html"}});!function a(){if(n)return;showLoad();n=!0;goAPI({url:_api.carwash_check,data:{token:e.token},success:function(a){200==(a=a.data).result?($(".container").html(juicer($("#main-tpl").html(),$.extend(a,{time_end:o}))),$(".num-type").initNumberBox({max:Number(a.number),value:1,input:!1,event_change:function(n){i=n}}),$("#btn-pay").on("click",function(){!function(e){if(n)return;if(!_config.is_wx_mobile)return void showConfirm({str:"请使用微信移动客户端打开该页面再进行支付"});_config.wx_config?r(e):t=e}({token:e.token,number:i})})):201==a.result?showConfirm({str:"您邀请的好友还未满2人，无法购买",btn_yes:{str:"去邀请好友",href:"/hfive/view/share.html"}}):showConfirm({str:a.message,btn_yes:{str:"回到首页",href:"/hfive/view/index.html"}})},error:function(n){showConfirm({str:n,btn_yes:{str:"重新加载",event_click:a}})},complete:function(){hideLoad(),n=!1}})}()}function r(e){n||(showLoad(),n=!0,goAPI({url:_api.carwash_pay,data:e,traditional:!0,success:function(n){wx.chooseWXPay({appId:n.data.appId,timestamp:n.data.timeStamp.toString(),nonceStr:n.data.nonceStr,package:n.data.package,signType:n.data.signType,paySign:n.data.paySign,success:function(n){showConfirm({str:"支付成功",btn_yes:{str:"确定",href:"/hfive/view/coupon.html"}})}})},error:function(n){showConfirm({str:n})},complete:function(){hideLoad(),n=!1}}))}}();