"use strict";!function(){var t,i=!1,n=0,o={},a={},e=getUrlPar("id"),r=checkLogin(!0),s=null;function c(){var i=o[t]?o[t]:o[1];(n=99==i?a[e].yearPayAmount:i)>0?$("#btn-pay").text("确认支付（"+n+"元）"):$("#btn-pay").text("确认支付")}function f(t){i||(showLoad(),i=!0,goAPI({url:_api.car_pay,data:t,traditional:!0,success:function(t){wx.chooseWXPay({appId:t.data.appId,timestamp:t.data.timeStamp.toString(),nonceStr:t.data.nonceStr,package:t.data.package,signType:t.data.signType,paySign:t.data.paySign,success:function(t){showConfirm({str:"支付成功，即将返回上一个页面",class:"shadow-blue",cover_background:"rgba(255,255,255,0.5)",btn_yes:{str:null}}),setTimeout(function(){window.history.go(-1)},2e3)}})},error:function(t){showConfirm({str:t})},complete:function(){hideLoad(),i=!1}}))}r&&(e?function h(){if(i)return;showLoad();i=!0;goAPI({url:_api.pay_cars,data:{token:r.token},success:function(h){if(h=h.data,_config.is_wx_mobile&&!_config.wx_config&&configWXJSSDK(["chooseWXPay"].concat(_config.wx_share),{success:function(){s&&f(s)}}),$.isArray(h.carList)&&0!==h.carList.length){for(var u=0,d=h.amountList.length;u<d;u++)o[h.amountList[u].id]=h.amountList[u].amount,0===u&&(t=h.amountList[u].id);if($.isArray(h.carList))for(var u=0,d=h.carList.length;u<d;u++)a[h.carList[u].id]=h.carList[u];a[e]?($(".container").html(juicer($("#main-tpl").html(),$.extend(h,{car:a[e]}))),c(),$("#level-box").on("click",".level-item",function(){var i=$(this);i.hasClass("active")||(i.addClass("active").siblings().removeClass("active"),t=i.data("value"),c())}),$("#btn-pay").on("click",function(){n>0&&function(t){if(i)return;if(!_config.is_wx_mobile)return void showConfirm({str:"请使用微信移动客户端打开该页面再进行支付"});_config.wx_config?f(t):s=t}({token:r.token,CarId:[e],amountId:t})})):showConfirm({str:"该车辆不存在或已支付过",btn_yes:{str:"返回上一页",href:"javascript:history.go(-1);"},btn_no:{str:"回到首页",href:"/hfive/view/index.html"}})}else showConfirm({title:"暂无车辆信息",str:"如果您已添加车辆，请等待车辆通过审核",btn_yes:{str:"去添加车辆",href:"/hfive/view/car_add.html"},btn_no:{str:"回到主页",href:"/hfive/view/index.html"}})},error:function(t){showConfirm({str:t,btn_yes:{str:"重新加载",event_click:h}})},complete:function(){hideLoad(),i=!1}})}():showConfirm({str:"缺少车辆id",btn_yes:{str:"返回上一页",href:"javascript:history.go(-1);"},btn_no:{str:"回到首页",href:"/hfive/view/index.html"}}))}();