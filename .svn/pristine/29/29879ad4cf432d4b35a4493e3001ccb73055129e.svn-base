"use strict";!function(){var t,n=!1,i=0,a={},o={},e=getUrlPar("id"),s=checkLogin(!0),r=null;function c(){if(99==(i=a[t]?a[t]:a[1])){var n=o[e];n&&(i=n.yearPayAmount)}i>0?$("#btn-pay").text("确认支付（"+i+"元）"):$("#btn-pay").text("确认支付")}function f(t){n||(showLoad(),n=!0,goAPI({url:_api.car_pay,data:t,traditional:!0,success:function(t){wx.chooseWXPay({appId:t.data.appId,timestamp:t.data.timeStamp.toString(),nonceStr:t.data.nonceStr,package:t.data.package,signType:t.data.signType,paySign:t.data.paySign,success:function(t){showConfirm({class:"success",title:"您的"+o[e].licensePlateNumber+"车辆信息\n提交成功！",str:"恭喜您！您的爱车进入30天观察期，观察期后正式生效",btn_yes:{str:"我知道了",href:"/hfive/view/car.html"}})}})},error:function(t){showConfirm({str:t})},complete:function(){hideLoad(),n=!1}}))}s&&(e?function u(){if(n)return;showLoad();n=!0;goAPI({url:_api.pay_cars,data:{token:s.token},success:function(u){u=u.data,_config.is_wx_mobile&&!_config.wx_config&&configWXJSSDK(["chooseWXPay"].concat(_config.wx_share),{success:function(){r&&f(r)}});for(var l=0,h=u.amountList.length;l<h;l++)a[u.amountList[l].id]=u.amountList[l].amount,0===l&&(t=u.amountList[l].id);if($.isArray(u.carList))for(var l=0,h=u.carList.length;l<h;l++)o[u.carList[l].id]=u.carList[l];o[e]?($(".container").html(juicer($("#main-tpl").html(),$.extend(u,{car:o[e]}))),c(),$("#level-box").on("click",".level-item",function(){var n=$(this);n.hasClass("active")||(n.addClass("active").siblings().removeClass("active"),t=n.data("value"),c())}),$("#btn-pay").on("click",function(){i>0&&function(t){if(n)return;if(!_config.is_wx_mobile)return void showConfirm({str:"请使用微信移动客户端打开该页面再进行支付"});_config.wx_config?f(t):r=t}({token:s.token,CarId:[e],amountId:t})})):showConfirm({str:"该车辆不存在或已支付过",btn_yes:{str:"返回上一页",href:"javascript:history.go(-1);"},btn_no:{str:"回到首页",href:"/hfive/view/index.html"}})},error:function(t){showConfirm({str:t,btn_yes:{str:"重新加载",event_click:u}})},complete:function(){hideLoad(),n=!1}})}():showConfirm({str:"缺少车辆id",btn_yes:{str:"返回上一页",href:"javascript:history.go(-1);"},btn_no:{str:"回到首页",href:"/hfive/view/index.html"}}))}();