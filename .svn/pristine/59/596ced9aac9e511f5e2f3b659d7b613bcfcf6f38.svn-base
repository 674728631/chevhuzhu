"use strict";var user_data,loading=!1,user=checkLogin(!0),share_url="",money_base=1e3,money_max=1500,money_reward=125,avatar_loaded=!1,qrcode_loaded=!1;function loadData(){showLoad(),loading=!0,goAPI({url:_api.user,data:{token:user.token},success:function(e){user_data=e.data,goAPI({url:_api.user_other,data:{customerId:user_data.id},success:function(e){loading=!1;var a=e.data;a.qrcode||(qrcode_loaded=!0),$("#container").html(juicer($("#main-tpl").html(),a)),$("#btn-rule").on("click",function(){showConfirm({class:"tl",title:"会员特权",str:"分享海报邀请朋友扫码免费领取"+money_base+"元擦挂维修金，并关注公号添加车牌；平台自动为Ta充值基础互助金，30天观察期后可开始限时体验擦挂维修。\n\n福利一：\n每邀请一位朋友加入，自己的维修额度提升"+money_reward+"元，最多增加"+4*money_reward+"提升至"+(money_base+4*money_reward)+"元；\n\n福利二：\n每邀请一位朋友加入，平台为你自己的账户充值3元互助金。",cover_close:!0})})},error:function(e){loading=!1,hideLoad(),showConfirm({str:e,btn_yes:{str:"重新加载",event_click:loadData}})}})},error:function(e){hideLoad(),loading=!1,showConfirm({str:e,btn_yes:{str:"重新加载",event_click:loadData}})}})}function showAvatar(e){resetImg(e),avatar_loaded=!0,showImg()}function showQrcode(){qrcode_loaded=!0,showImg()}function showImg(){avatar_loaded&&qrcode_loaded&&createImg(function(){$("#text1").addClass("hide"),$("#qr").addClass("hide"),$("#source").addClass("upper"),$("#container").addClass("red"),hideLoad()})}function createImg(e){setTimeout(function(){$("#main").height($("#main").height()),$("#source").height($("#main").height()),$(".avatar img").removeAttr("onload"),$("#qr img").removeAttr("onload");var a=$("#main"),o=a.width(),t=a.height(),n=document.createElement("canvas"),r=a.get(0).getBoundingClientRect();n.width=1*o,n.height=1*t,n.style.width=1*o+"px",n.style.height=1*t+"px";var d=n.getContext("2d");d.scale(1,1),d.translate(-r.left,-r.top-$("#container").scrollTop()),html2canvas(a[0],{canvas:n,useCORS:!0,onrendered:function(a){$("#source").append($("<img>",{class:"view",src:a.toDataURL("image/png")})),$("#source .view").length>1&&$("#source .view:eq(0)").remove(),$.isFunction(e)&&e()}})},300)}user&&loadData();