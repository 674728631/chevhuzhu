function datapicker(e){var a=$.extend({data:null,class:null,active_level:null,item_height:60,item_number:3,cover:!0,auto_fill_all:!1,fill_all_item:[{value:0,name:"全部"}],init_value:null,node:null,event_init:null,event_show:null,event_scroll:null,event_ok:null,event_cancel:null},e);("number"!==$.type(a.item_height)||a.item_height<=0)&&(a.item_height=60),"number"!==$.type(a.item_number)||a.item_number<3?a.number=1:0===Math.floor(a.item_number/2)&&(a.item_number=a.item_number-1),$.isArray(a.init_value)||(a.init_value=[a.init_value]),$.isFunction(a.event_scroll)||(a.event_scroll=null),$.isFunction(a.event_show)||(a.event_show=null);var t,i,n,l,s=a.item_height*a.item_number,o=a.item_height*Math.floor(a.item_number/2),r=!1,u=0,c=[],v=[],d=[],m=[],h=[],f=0,p=0,_=!0,k=function(e){e.preventDefault();var a=$(this);(_||i===a.index())&&(r=!0,n=e.touches?e.touches[0].pageY-a.offset().top:e.pageY-a.offset().top,A.addClass("full"),a.addClass("full"),i=a.index(),t=c[i].removeClass("animation"),l=d[i],p=n,f=Date.now(),_=!0)},b=function(e){if(r){var u=$(this),c=(u.height()-s)/2,v=e.touches?e.touches[0].pageY-u.offset().top-c:e.pageY-u.offset().top-c,h=v-n;if((l=d[i]+h)>o)l=o+(k=l-o)/10;else if(l<a.item_height*(Math.floor(a.item_number/2)+1-m[i])){var k=a.item_height*(Math.floor(a.item_number/2)+1-m[i])-l;l=a.item_height*(Math.floor(a.item_number/2)+1-m[i])-k/10}t.css({"webkit-transform":"translateY("+l+"px) translateZ(0)",transform:"translateY("+l+"px) translateZ(0)"}).children(".pick-item.checked").removeClass("checked");var b=Date.now();_=!0,b-f>300&&(f=b,p=v)}},g=function(e){if(r){var n,u=$(this),c=(u.height()-s)/2,v=e.changedTouches?e.changedTouches[0].pageY-u.offset().top-c:e.pageY-u.offset().top-c,h=Date.now(),k=(v-p)/(h-f);_=!1,r=!1,A.removeClass("full"),u.removeClass("full"),g=h,C=l,Y=6e-4*(w=(b=k)>0?-1:1),function e(){if(!_){var s=Date.now()-g,r=b+s*Y;if(w*r>=0||l>o||l<a.item_height*(Math.floor(a.item_number/2)+1-m[i])){if(l>o)n=0;else if(l<a.item_height*(Math.floor(a.item_number/2)+1-m[i]))n=m[i]-1;else{var u=o-l;n=Math.floor(u/a.item_height),u%a.item_height*2>=a.item_height&&n++}return t.addClass("animation"),x(i,n),void(_=!0)}l=C+(b+r)/2*s,d[i]=l,t.css({"webkit-transform":"translateY("+l+"px) translateZ(0)",transform:"translateY("+l+"px) translateZ(0)"}),setTimeout(e,10)}}()}var b,g,C,w,Y},x=function(e,i){var n=a.item_height*(Math.floor(a.item_number/2)-i),l=c[e].css({"webkit-transform":"translateY("+n+"px) translateZ(0)",transform:"translateY("+n+"px) translateZ(0)"});if(setTimeout(function(){t.removeClass("animation")},400),h[e].index==i)l.find(".pick-item:eq("+i+")").addClass("checked").siblings().removeClass("checked");else{d[e]=n;var s=l.find(".pick-item:eq("+i+")").addClass("checked").siblings().removeClass("checked").end(),o=e+1;if(h[e]={name:s.text(),value:s.data("value"),index:i},!$.isArray(a.data)){for(;;){for(var r=a.data[h[0].value],f=1;f<o;f++)if(f<=e)r=r.value[h[f].value];else{if(a.auto_fill_all){a.fill_all_item[f]?h[f]={name:a.fill_all_item[f].name,value:a.fill_all_item[f].value,index:0}:h[f]={name:"全部",value:0,index:0},r=null;break}for(var p in r.value){h[f]={name:r.value[p].name?r.value[p].name:r.value[p],value:p,index:0},r=r.value[p];break}}if(!r||!r.value||a.active_level&&!(a.active_level>0&&o<a.active_level)){for(f=o;f<u;f++)v[f].remove(),c[f].remove(),v[f]=null,c[f]=null,h[f]=null;break}l=C(r.value,null,o);m[o]=l.len,d[o]=l.translate,h[o]={name:l.found_name,value:l.found_value,index:l.found_index},v[o]||(v[o]=$('<a class="pick-touch" href="javascript:"></a>'),T.append(v[o])),c[o]||(c[o]=$('<div class="pick-list"></div>'),Z.append(c[o])),c[o].html(l.str).css({"webkit-transform":"translateY("+l.translate+"px) translateZ(0)",transform:"translateY("+l.translate+"px) translateZ(0)"}).find(".pick-item:eq("+l.found_index+")").addClass("checked"),o++}u=o}}a.event_scroll&&a.event_scroll(h,e)},C=function(e,t,i){var n,l,s,o="",r=0,u=null;for(var c in a.auto_fill_all&&(a.fill_all_item[i]?(o+='<div class="pick-item" data-value="'+a.fill_all_item[i].value+'">'+a.fill_all_item[i].name+"</div>",n=a.fill_all_item[i].name,l=a.fill_all_item[i].value):(o+='<div class="pick-item" data-value="0">全部</div>',n="全部",l=0),r++,s=0),e){var v=e[c];"object"===$.type(v)&&(v=v.name),(0===r||t&&t==c)&&(n=v,l=c,s=r,e[c].value&&(u=c)),o+='<div class="pick-item" data-value="'+c+'">'+v+"</div>",r++}return{str:o,len:r,translate:a.item_height*(Math.floor(a.item_number/2)-s),found_index:s,found_value:l,found_name:n,next_key:u}};function w(){var e,t,i=a.data;if(u=0,c=[],v=[],m=[],d=[],h=[],$.isArray(i))for(var n=i.length;e=C(i[u],a.init_value[u],u),u++,c.push($('<div class="pick-list">'+e.str+"</div>")),v.push($('<a class="pick-touch" href="javascript:"></a>')),m.push(e.len),d.push(e.translate),h.push({name:e.found_name,value:e.found_value,index:e.found_index}),u<n;);else for(;t=(e=C(i,a.init_value[u],u)).next_key,u++,c.push($('<div class="pick-list">'+e.str+"</div>")),v.push($('<a class="pick-touch" href="javascript:"></a>')),m.push(e.len),d.push(e.translate),h.push({name:e.found_name,value:e.found_value,index:e.found_index}),t&&(!a.active_level||a.active_level>0&&u<a.active_level)?i=i[t].value:t=null,t;);Z.html(c),T.html(v);for(var l=0,s=c.length;l<s;l++)c[l].css({width:Math.round(1e4/s)/100+"%","webkit-transform":"translateY("+d[l]+"px) translateZ(0)",transform:"translateY("+d[l]+"px) translateZ(0)"}).find(".pick-item:eq("+h[l].index+")").addClass("checked");a.event_show&&a.event_show(h)}var Y=$('<div class="pick-btn-box clearfix"></div>'),y=$('<a class="pick-btn-ok" href="javascript:">确定</a>').on("click",function(){P.hide(),$.isFunction(a.event_ok)&&a.event_ok(h)}),M=$('<a class="pick-btn-cancel" href="javascript:">取消</a>').on("click",function(){P.hide(),$.isFunction(a.event_cancel)&&a.event_cancel(h)}),Z=$('<div class="pick-main"></div>'),j=$('<div class="pick-box"></div>').append(Z.css({height:s,"line-height":a.item_height+"px"}),Y.append(M,y)),D=$('<div class="pick-bg"></div>').on("click",function(){P.hide()}),T=$('<div class="pick-touch-box"></div>'),A=$('<div class="pick-touch-wrap"></div>').append(T).height(s).on("touchstart",".pick-touch",k).on("mousedown",".pick-touch",k).on("touchmove",".pick-touch",b).on("mousemove",".pick-touch",b).on("touchend",".pick-touch",g).on("mouseup",".pick-touch",g),F=$('<div class="pick-wrap"></div>').append(D,j,A).on("touchmove",function(e){e.preventDefault(),e.stopPropagation()}),q=$('<div class="datapick"></div>').addClass(a.class);a.node&&(j.prepend($('<div class="pick-node"></div>').append(a.node)),A.addClass("node")),$("body").append(q.append(F)),$.isFunction(a.event_init)&&(w(),a.event_init(h));var P={show:function(e,t){(t||a.data)&&(t&&(a.data=t),e&&$.isArray(e)?a.init_value=e:e&&!$.isArray(e)?a.init_value=[e]:a.init_value=[null],w(),a.cover?q.addClass("pick-cover"):q.removeClass("pick-cover"),q.css("display","block"),setTimeout(function(){q.addClass("open")},50))},hide:function(){q.removeClass("open"),setTimeout(function(){q.css("display","none")},400)}};return P}