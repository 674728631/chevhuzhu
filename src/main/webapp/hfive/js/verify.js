"use strict";!function(){var e=!1,o=!1,t=!1,i=getUrlPar("phone"),n=loadStorage("from_url"),r=loadStorage("to_url"),a=["","","",""],s=0;if(checkLogin()&&(delStorage("from_url"),delStorage("to_url"),n&&new RegExp("^http://www.chevhuzhu.com/hfive","i").test(n)?window.location.href=n:r&&new RegExp("^http://www.chevhuzhu.com/hfive","i").test(r)?window.location.href=r:window.location.href="/hfive/view/profile.html"),_config.is_wx&&wxOauth(function(){configWXJSSDK(_config.wx_share,{success:function(){shareWX({title:_share_title,desc:_share_desc,link:_share_link})}})}),validatePhone(i,!0)){$(".container").html(juicer($("#main-tpl").html(),{phone:i}));var c=$("#btn-code"),l=$("#btn-confirm"),h=vkeyboard({exception_class:"code-item",event_show:function(){$(window).height()-l.offset().top<$("#vkeyboard").height()&&($(".container").addClass("spec"),$(window).scrollTop($("#t2").offset().top))},event_close:function(){$(".container").removeClass("spec")},event_input:function(e,o){"confirm"===e?s>=3&&(h.hide(),d()):"delete"===e?(""===a[s]&&(s-=1)<0&&(s=0),a[s]="",$(".code-item").eq(s).text("").removeClass("active"),h.confirmDisable(),l.addClass("weak").removeClass("strong")):(a[s]=e,$(".code-item").eq(s).text(e).addClass("active"),(s+=1)>3&&(s=3,h.confirmEnable(),l.addClass("strong").removeClass("weak"),d()))}});h.confirmDisable(),h.show(),f(60),c.on("click",function(){if(o||t)return;showLoad({str:"验证码发送中"}),o=!0,goAPI({url:_api.code,type:"get",data:{mobileNumber:i+"_1"},success:function(e){showAlert("验证码已发送，请注意查收"),f(60)},error:function(e){c.text("发送验证码"),showConfirm({str:e})},complete:function(){hideLoad(),o=!1}})}),$("#code-box").on("click",".code-item",function(){h.show()}),l.on("click",function(){s>=3&&d()})}else showConfirm({str:"手机号码有误，请重新填写",btn_yes:{href:"/hfive/view/login.html?redir="+redirct_url}});function f(e){e>0?(t=!0,c.text(e+"s"),setTimeout(function(){f(e-1)},1e3)):(t=!1,c.text("发送验证码").removeClass("disabled"))}function d(){if(!e){var o=a.join("");0!==o.length?/^[0-9]{4}$/.test(o)?function(o,t){if(e)return;e=!0,showLoad({str:"登录中"}),goAPI({url:_api.login,data:{phoneAndCode:o+"_"+t,fromId:loadStorage("from_id",!0)||"null"},success:function(e){if((e=e.data).token)if(e.phone=o,saveStorage("user",e,!0),$.isArray(e.chemamaHint)&&e.chemamaHint.length>0?saveStorage("login_chemama",e.chemamaHint):1==e.firstLogin&&saveStorage("login_coupon",e.coupon),delStorage("to_url"),delStorage("from_id",!0),new RegExp("^http://www.chevhuzhu.com/hfive","i").test(r))if(/\/car_add.html/.test(r)&&"index"===getUrlPar("from",r)){var t=e.carList;if($.isArray(t)&&t.length>0)if(1===t.length){var i=t[0];1==i.status?window.location.href="/hfive/view/car_add_pay.html?id="+i.id:2==i.status?window.location.href="/hfive/view/car_add2.html?id="+i.id:10==i.status||13==i.status||31==i.status?window.location.href="/hfive/view/car.html?type=2":12==i.status?window.location.href="/hfive/view/car_add.html?id="+i.id:20==i.status?window.location.href="/hfive/view/car.html":30==i.status?window.location.href="/hfive/view/car_add.html?rejoin=1&id="+i.id:window.location.href=r}else{for(var n=!1,a=0,s=t.length;a<s;a++)if(20==t[a].status){n=!0;break}window.location.href=n?"/hfive/view/car.html":"/hfive/view/car.html?type=2"}else window.location.href=r}else window.location.href=r;else window.location.href="/hfive/view/profile.html";else showConfirm({str:"获取用户信息失败，请重新登录"})},error:function(e){showConfirm({str:e})},complete:function(){e=!1,hideLoad()}})}(i,o):showAlert("请输入4位纯数字的验证码"):showAlert("请输入验证码")}}}();