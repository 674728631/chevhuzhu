"use strict";!function(){var t,e=!1,n=0,i={},a={},o=getUrlPar("id"),r=checkLogin(!0),s=null;function c(){var e=i[t]?i[t]:i[1];(n=99==e?a[o].yearPayAmount:e)>0?$("#btn-pay").text("确认支付（"+n+"元）"):$("#btn-pay").text("确认支付")}function f(t){e||(showLoad(),e=!0,goAPI({url:_api.car_pay,data:t,traditional:!0,success:function(t){wx.chooseWXPay({appId:t.data.appId,timestamp:t.data.timeStamp.toString(),nonceStr:t.data.nonceStr,package:t.data.package,signType:t.data.signType,paySign:t.data.paySign,success:function(t){showConfirm({str:"支付成功，即将返回上一个页面",class:"shadow-blue",cover_background:"rgba(255,255,255,0.5)",btn_yes:{str:null}}),setTimeout(function(){window.history.go(-1)},2e3)}})},error:function(t){showConfirm({str:t})},complete:function(){hideLoad(),e=!1}}))}juicer.register("build_payText",function(t){if(13==t.status||20==t.status){if(t.observationEndTime){var e=new Date(t.observationEndTime.time);return"保障至"+new Date(e.getFullYear(),e.getMonth(),e.getDate()+365).formatDate("yyyy-MM-dd")}return"分摊全年12个月"}e=new Date;return"保障至"+new Date(e.getFullYear(),e.getMonth(),e.getDate()+395).formatDate("yyyy-MM-dd")}),r&&(o?function u(){if(e)return;showLoad();e=!0;goAPI({url:_api.pay_cars,data:{token:r.token},success:function(u){if(u=u.data,_config.is_wx_mobile&&!_config.wx_config&&configWXJSSDK(["chooseWXPay"].concat(_config.wx_share),{success:function(){s&&f(s)}}),$.isArray(u.carList)&&0!==u.carList.length){for(var d=0,l=u.amountList.length;d<l;d++)i[u.amountList[d].id]=u.amountList[d].amount,0===d&&(t=u.amountList[d].id);if($.isArray(u.carList))for(var d=0,l=u.carList.length;d<l;d++)a[u.carList[d].id]=u.carList[d];a[o]?($(".container").html(juicer($("#main-tpl").html(),$.extend(u,{car:a[o]}))),c(),$("#level-box").on("click",".level-item",function(){var e=$(this);e.hasClass("active")||(e.addClass("active").siblings().removeClass("active"),t=e.data("value"),c())}),$("#btn-pay").on("click",function(){n>0&&function(t){if(e)return;if(!_config.is_wx_mobile)return void showConfirm({str:"请使用微信移动客户端打开该页面再进行支付"});_config.wx_config?f(t):s=t}({token:r.token,CarId:[o],amountId:t})})):showConfirm({str:"该车辆不存在",btn_yes:{str:"返回上一页",href:"javascript:history.go(-1);"},btn_no:{str:"回到首页",href:"/hfive/view/index.html"}})}else showConfirm({title:"暂无车辆信息",str:"如果您已添加车辆，请等待车辆通过审核",btn_yes:{str:"去添加车辆",href:"/hfive/view/car_add.html"},btn_no:{str:"回到主页",href:"/hfive/view/index.html"}})},error:function(t){showConfirm({str:t,btn_yes:{str:"重新加载",event_click:u}})},complete:function(){hideLoad(),e=!1}})}():showConfirm({str:"缺少车辆id",btn_yes:{str:"返回上一页",href:"javascript:history.go(-1);"},btn_no:{str:"回到首页",href:"/hfive/view/index.html"}}))}();