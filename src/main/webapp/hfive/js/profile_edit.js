"use strict";!function(){var e,n=!1,t=checkLogin(!0);function i(){n||pushMenu({title:"设置性别",data:[{value:1,name:"男"},{value:0,name:"女"}],event_click:function(n){a({sex:n.value},function(){showAlert("性别设置成功"),e.gender=n.value,$("#sex-txt").text(n.name)})}})}function o(){n||showConfirm({str:"设置姓名",class:"edit2",node:$('<input id="nickname" type="text" maxlength="50" placeholder="请输入您的姓名">').val(e.userName),btn_yes:{click_close:!1,event_click:function(){if(!n){var t=$("#nickname").val().trim();0!==t.length?a({userName:t},function(){hideConfirm(),showAlert("姓名设置成功"),e.userName=t,$("#nickname-txt").text(t)}):showAlert("姓名不能为空")}}},btn_cancel:{str:"取消"}})}function c(){if(!n){n=!0,showLoad();var e=$(this),t=this.files[0];resizeImg({file:t,width:400,success:function(n){e.val(""),a({base:n.base64},function(){showAlert("头像设置成功"),$(".avatar").empty().insertImg(n.base64),$("#avatar-txt").text("修改")})},fail:function(){showAlert("无法处理该图片\n请选择其它图片"),hideLoad()},complete:function(){n=!1}})}}function s(){n||showConfirm({str:"是否退出登录",cover_close:!0,btn_yes:{event_click:function(){delStorage("user",!0),window.location.href="/hfive/view/profile.html"}},btn_cancel:{str:"取消"}})}function a(e,i){n||(showLoad(),n=!0,goAPI({url:_api.user_edit,data:$.extend({token:t.token},e),success:function(e){$.isFunction(i)&&i()},error:function(e){showConfirm({str:e})},complete:function(){hideLoad(),n=!1}}))}t&&function a(){if(n)return;showLoad();n=!0;goAPI({url:_api.user,data:{token:t.token},success:function(n){e=n.data,$(".container").html(juicer($("#main-tpl").html(),e)),$("#avatar-upload").on("change",c),$("#btn-nickname").on("click",o),$("#btn-sex").on("click",i),$("#btn-logout").on("click",s),_config.is_wx&&!_config.wx_config&&configWXJSSDK(_config.wx_share,{success:function(){shareWX({title:_share_title,desc:_share_desc,link:_share_link})}})},error:function(e){showConfirm({str:e,btn_yes:{str:"重新加载",event_click:a}})},complete:function(){hideLoad(),n=!1}})}()}();