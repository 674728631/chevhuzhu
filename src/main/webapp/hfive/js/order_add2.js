"use strict";!function(){var e,t,i,o,n=!1,r=checkLogin(!0),s=getUrlPar("id"),a=getUrlPar("oid"),d="";function l(e){$("#d-owner").val(e.owner),$("#d-vin").val(e.vin),$("#d-model").val(e.model),$("#d-engine").val(e.engine_num);var t=toDate(e.register_date);t?$("#d-register").val(t.formatDate("yyyy-MM-dd")):$("#d-register").val("");var i=toDate(e.issue_date);i?$("#d-issue").val(i.formatDate("yyyy-MM-dd")):$("#d-issue").val(""),e.owner&&e.model?($("#d-owner2").text(e.owner),$("#d-model2").text(e.model),$("#driver-info").addClass("hide"),$("#driver-info2").removeClass("hide")):($("#driver-info").removeClass("hide"),$("#driver-info2").addClass("hide"))}function c(i){$(".container").html(juicer($("#main-tpl").html(),i)),_config.is_wx&&!_config.wx_config&&configWXJSSDK(["chooseImage","uploadImage"].concat(_config.wx_share),{success:function(){}}),i&&(d=(e=i).licensePlateNumber,$("#d-plate2").text(d),!s&&e.carId&&(s=e.carId),i.drivingLicense&&(t={src:i.drivingLicense,id:""},$("#img1").insertImg(i.drivingLicense,"full").closest(".btn-upload").removeClass("default"),$(".reupload-box").removeClass("hide"),l({owner:i.nameCarOwner,model:i.model,plate_num:i.licensePlateNumber,vin:i.VIN,engine_num:i.engineNum,register_date:i.registerDate,issue_date:i.issueDate}))),$("#btn-edit").on("click",function(){$("#driver-info").removeClass("hide"),$("#driver-info2").addClass("hide")}),$("#upload-car").on("click",function(){if(_config.is_wx_mobile)if(_config.wx_config){var e=$(this);wx.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(i){var o=i.localIds;wxUploadPhoto({localId:o[0],success:function(i){var r,s=i.serverId;e.removeClass("default").find(".upload-img").html('<img src="'+o[0]+'" onload="resetImg(this, \'full\')" data-value="'+s+'">'),r={src:o[0],id:s},n||(showLoad({str:"图片识别中"}),n=!0,goAPI({url:_api.recognition_driver,data:{image:r.id,side:"face"},success:function(e){t=r,l(e.data),$(".reupload-box").removeClass("hide"),$window.scrollTop(0)},error:function(e){showConfirm({str:e,btn_yes:{event_click:function(){t?$("#img1").html('<img src="'+t.src+'" onload="resetImg(this, \'full\')" data-value="'+t.id+'">'):($("#img1").empty(),$(".btn-upload").addClass("default"))}}})},complete:function(){hideLoad(),n=!1}})),$(".reupload-box").removeClass("hide")}})}})}else showAlert("正在调用摄像头...请稍后再点击");else showAlert("请在手机微信客户端中上传照片")}),$("#btn-pay").on("click",function(){var e,t=$("#img1 img"),i=$("#d-owner").val().trim(),o=$("#d-model").val().trim(),l=$("#d-vin").val().trim(),c=$("#d-engine").val().trim(),u=$("#d-register").val().trim(),m=$("#d-issue").val().trim();0!==t.length?0!==i.length?0!==o.length?(e={carId:s,eventNo:a,token:r.token,base:/^http/.test(t.eq(0).attr("src"))?"":t.eq(0).data("value"),nameCarOwner:i,VIN:l,model:o,engineNum:c,registerDate:u?toDate(u).formatDate("yyyy/MM/dd"):"",issueDate:m?toDate(m).formatDate("yyyy/MM/dd"):""},n||(showLoad(),n=!0,goAPI({url:_api.add_license,data:e,success:function(e){showConfirm({class:"success",full:!0,title:"您的"+d+"车辆信息\n提交成功！",str:"我们将在一个工作日内完成审核，请留意信息，车V互助为您的爱车保驾护航！",btn_yes:{str:"我知道了",href:"/hfive/view/order.html"}})},error:function(e,t,i){showConfirm({class:"fail",full:!0,title:"您的"+d+"车辆信息提交失败！\n请重新提交",str:"失败原因："+e,btn_yes:{str:"我知道了"}})},complete:function(){hideLoad(),n=!1}}))):showAlert("行驶证品牌型号不能为空"):showAlert("行驶证所有人不能为空"):showAlert("请上传行驶证照片")})}r&&(s||a?a?function e(t,i){n||(showLoad(),n=!0,goAPI({url:_api.order_detail,data:t,success:function(e){$.isFunction(i)&&i(e.data)},error:function(o){showConfirm({str:o,btn_yes:{str:"重新加载",event_click:function(){e(t,i)}}})},complete:function(){hideLoad(),n=!1}}))}({token:r.token,eventNo:a},c):(i={token:r.token,id:s},o=c,n||(showLoad(),n=!0,goAPI({url:_api.car_detail,data:i,success:function(e){$.isFunction(o)&&o(e.data)},error:function(e){showConfirm({str:e})},complete:function(){hideLoad(),n=!1}}))):showConfirm({str:"缺少车辆ID",btn_yes:{str:"返回上一页",href:"javascript:history.go(-1);"},btn_no:{str:"回到首页",href:"/hfive/view/index.html"}}))}();