function preview(e){var t,a,i,l,s,n,r,o={container:null,imgs:null,index:1,height:200,dis:50,dely:3500,duration:400,click_close:!0,vertical:!1,fill:"auto",type:"loop",lazyload:!0,number:!1,point:!1,auto:!1,fixed:!0,background:null,event_click:null},d=$.extend({},o,e);null==d.container&&(d.container=$("body"));var c,u,f,p,v,h,g,m,y,b,w,k,x=!1,I=!1,C=0,_=0,j=0,D=0,M=0,z=0,T=0,A=0,X=!1,Y=!1,q=0,F=0,B=0,E={loop:1,single:1,"single-back":1},G=!0,H=!0,J=$('<div class="preview"></div>'),K=L();function L(){if($.isArray(d.imgs)){if($.isArray(d.imgs)&&d.imgs.length<=0)return!1}else d.imgs=[d.imgs];if(1!==E[d.type]&&(d.type=o.type),p=d.fill&&"string"===$.type(d.fill)?'resetImg(this, "'+d.fill+'")':"resetImg(this)",$.isFunction(d.event_click)||(d.event_click=null),r=$.map(d.imgs,function(e){if(e){var t=e.src;return t||"string"!==$.type(e)||(t=e),$('<div class="preview-img"></div>').attr(d.lazyload?"data-src":"src",t).attr({"data-href":e.href?e.href:"","data-default":e.default?e.default:""})}}),n=r.length,"loop"===d.type?(G=!0,H=!0,l=1,s=n):(H="single-back"===d.type,G=!1,l=0,s=n-1),n<=0)return!1;if(1===n)(e=$(r[0])).append($("<img>",{src:e.data("src"),onload:p,onerror:e.data("default")?'setDefaultImg(this, "'+e.data("default")+'")':"javascript:;"}));else if(n>1&&G){var e=$(r[0]),t=$(r[n-1]);r.insertAt(n,e.clone()),r.insertAt(0,t.clone())}for(var a="",c=0;c<n;c++)a+='<a href="javascript:;"></a>';return v=$("<span></span>"),h=$("<span>"+n+"</span>"),g=$('<div class="preview-list"></div>').append(r),m=$('<div class="preview-main"></div>').append(g),y=$('<div class="preview-number"></div>').append(v,"/",h),b=$('<div class="preview-point"></div>').append(a),w=$('<a class="preview-touch" href="javascript:;"></>'),k=$('<div class="preview-bg"></div>'),d.vertical?J.addClass("vertical"):J.removeClass("vertical"),n>1&&(d.vertical?g.css({height:100*r.length+"%"}).find(".preview-img").css({height:Math.round(1e5/r.length)/1e3+"%"}):g.css({width:100*r.length+"%"}).find(".preview-img").css({width:Math.round(1e5/r.length)/1e3+"%"})),_reg_color.test(d.background)&&k.css("background",d.background),("number"!==$.type(d.dis)||d.dis<0)&&(d.dis=o.dis),("number"!==$.type(d.duration)||d.duration<0)&&(d.duration=o.duration),"number"!==$.type(d.dely)&&(d.dely=o.dely),d.dely<d.duration&&(d.dely=d.duration+10),(!/[1-9]+[0-9]*(px|em|rem|%)/i.test(d.height)||"number"===$.type(d.height)&&d.height<=0)&&(d.height=o.height),b.off("click").on("click","a",function(){if(!I){var e=$(this);e.hasClass("on")||(I=!0,d.auto&&f&&(clearInterval(f),f=null),i=e.index()+1,v.text(i),d.lazyload&&R(i),g.animate(d.vertical?{top:100*(1-l-i)+"%"}:{left:100*(1-l-i)+"%"},d.duration),e.addClass("on").siblings().removeClass("on"),setTimeout(function(){d.auto&&n>1&&!f&&(f=setInterval(N,d.dely)),I=!1},d.duration+10))}}),w.off().on({touchstart:O,mousedown:O}).on({touchmove:P,mousemove:P}).on({touchend:Q,mouseup:Q}).on("click",function(){if(!(n>1)){var e=$(r[0]).data("href");e?window.location.href=e:d.event_click&&d.event_click(i-1),d.fixed&&d.click_close&&J.css("display","none")}}),$('<div class="preview-box"></div>').append(k,m,w,b,y)}function N(){x||I||(I=!0,i++,G||i>n&&(i=1),g.animate(d.vertical?{top:100*(1-l-i)+"%"}:{left:100*(1-l-i)+"%"},d.duration),setTimeout(function(){G&&(i>s?i=l:i<=0&&(i=s)),v.text(i),b.children("a").removeClass("on").eq(i-1).addClass("on"),g.css(d.vertical?"top":"left",100*(1-l-i)+"%"),d.lazyload&&R(i),I=!1},d.duration+10))}function O(e){n<=1||I||(e.preventDefault(),w.addClass("full"),x=!0,t=d.container.width(),a=d.container.height(),c=t*(1-l-i),u=a*(1-l-i),C=e.touches?e.touches[0].pageX:e.pageX-w.offset().left,_=e.touches?e.touches[0].pageY:e.pageY-w.offset().top,q=j=C,F=D=_,X=!1,Y=!1,d.auto&&f&&(clearInterval(f),f=null))}function P(e){x&&(q=j,F=D,j=e.touches?e.touches[0].pageX:e.pageX-w.offset().left,D=e.touches?e.touches[0].pageY:e.pageY-w.offset().top,d.vertical?(A=u+(z=D-_),d.fixed,!H&&A>0?A=0:!H&&A<a*(1-n)&&(A=a*(1-n)),g.css("top",A)):(z=_-D,T=c+(M=j-C),A=$(window).scrollTop()+z,d.fixed?X?(!H&&T>0?T=0:!H&&T<t*(1-n)&&(T=t*(1-n)),g.css("left",T)):Math.abs(M)>=5&&(X=!0):X?(!H&&T>0?T=0:!H&&T<t*(1-n)&&(T=t*(1-n)),g.css("left",T)):Y&&($.os.tablet||$.os.phone)?$(window).scrollTop(A>0?A:0):Math.abs(M)>=5?X=!0:Math.abs(z)>=5&&(Y=!0)))}function Q(){if(w.removeClass("full"),!x||!d.fixed&&!d.vertical&&Y&&($.os.tablet||$.os.phone))return x=!1,void(d.auto&&n>1&&!f&&(f=setInterval(N,d.dely)));if(x=!1,B=d.vertical?D-_:j-C,Math.abs(B)<5){var e=$(r[i]).data("href");return e?window.location.href=e:d.event_click&&d.event_click(i-1),void(d.fixed&&d.click_close?J.css("display","none"):d.auto&&!f&&(f=setInterval(N,d.dely)))}Math.abs(B)>d.dis&&(d.vertical?B>0&&D-F>=0&&i>1-l?i--:B<=0&&D-F<=0&&i<=s&&i++:B>0&&j-q>=0&&i>1-l?i--:B<=0&&j-q<=0&&i<=s&&i++),H||(d.vertical||0!==T&&T!==t*(1-n))&&(!d.vertical||0!==A&&A!==a*(1-n))?(c=t*(1-l-i),u=a*(1-l-i),I=!0,g.animate(d.vertical?{top:u}:{left:c},d.duration),setTimeout(function(){G&&(i>s?i=l:i<=0&&(i=s)),v.text(i),b.children("a").removeClass("on").eq(i-1).addClass("on"),g.css(d.vertical?"top":"left",100*(1-l-i)+"%"),d.auto&&!f&&(f=setInterval(N,d.dely)),d.lazyload&&R(i),I=!1},d.duration+10)):d.auto&&!f&&(f=setInterval(N,d.dely))}function R(e){e=e-1+l;var t=$(r[e]);if(0==t.find("img").length&&t.append($("<img>").attr({src:t.data("src"),onload:p,onerror:t.data("default")?'setDefaultImg(this, "'+t.data("default")+'")':"javascript:;"})),e>0&&e<=s)0==(a=$(r[e+1])).find("img").length&&a.append($("<img>").attr({src:a.data("src"),onload:p,onerror:a.data("default")?'setDefaultImg(this, "'+a.data("default")+'")':"javascript:;"})),0==(i=$(r[e-1])).find("img").length&&i.append($("<img>").attr({src:i.data("src"),onload:p,onerror:i.data("default")?'setDefaultImg(this, "'+i.data("default")+'")':"javascript:;"}));else if(0==e){if(0==(a=$(r[e+1])).find("img").length&&a.append($("<img>").attr({src:a.data("src"),onload:p,onerror:a.data("default")?'setDefaultImg(this, "'+a.data("default")+'")':"javascript:;"})),G)0==(i=$(r[s+1])).find("img").length&&i.append($("<img>").attr({src:i.data("src"),onload:p,onerror:i.data("default")?'setDefaultImg(this, "'+i.data("default")+'")':"javascript:;"}))}else{var a,i;if(0==(a=$(r[e-1])).find("img").length&&a.append($("<img>").attr({src:a.data("src"),onload:p,onerror:a.data("default")?'setDefaultImg(this, "'+a.data("default")+'")':"javascript:;"})),G)0==(i=$(r[0])).find("img").length&&i.append($("<img>").attr({src:i.data("src"),onload:p,onerror:i.data("default")?'setDefaultImg(this, "'+i.data("default")+'")':"javascript:;"}))}}return K&&(J.append(K),K=null),J.appendTo(d.container),{show:function(e){$.extend(d,e);var t=L();t?(J.empty().append(t),t=null,J.css({height:d.height,display:"block"}),(i=d.index)<1?i=1:i>n&&(i=n),v.text(i),d.point&&n>1?b.css("display","block"):b.css("display","none"),d.number?y.css("display","block"):y.css("display","none"),d.fixed?J.addClass("fixed"):J.removeClass("fixed"),n>1&&(d.vertical?g.css("top",100*(1-l-i)+"%"):g.css("left",100*(1-l-i)+"%"),d.auto&&!f&&(f=setInterval(N,d.dely)),d.lazyload&&R(i)),b.children("a").removeClass("on").eq(i-1).addClass("on")):console.error("无有效图片")},hide:function(){J.css("display","none"),d.auto&&f&&(clearInterval(f),f=null)}}}